# ü¶∑ Sistema Odontol√≥gico

Sistema integral de gesti√≥n para consultorios odontol√≥gicos desarrollado con **Python Flask** y **Bootstrap 5**. Integra autom√°ticamente con **Airtable**, **Google Calendar** y **N8N** para una gesti√≥n completa y automatizada.

## ‚ú® Caracter√≠sticas Principales

- üìã **Gesti√≥n de Pacientes**: Registro, b√∫squeda y administraci√≥n completa de historias cl√≠nicas
- üìÖ **Calendario Inteligente**: Sincronizaci√≥n autom√°tica con Google Calendar
- üîÑ **Automatizaciones**: Integraci√≥n con N8N para workflows automatizados
- üíæ **Base de Datos**: Almacenamiento en Airtable con API robusta
- üì± **Responsive**: Interfaz moderna y adaptable a todos los dispositivos
- üîê **Seguro**: Configuraci√≥n de seguridad para entornos de producci√≥n

## üöÄ Tecnolog√≠as Utilizadas

- **Backend**: Python 3.8+ con Flask
- **Frontend**: Bootstrap 5.3 + JavaScript ES6
- **Base de Datos**: Airtable (API)
- **Calendario**: Google Calendar API
- **Automatizaci√≥n**: N8N Webhooks
- **Estilos**: CSS3 con variables personalizadas

## üìã Requisitos Previos

### Software Necesario
- Python 3.8 o superior
- Visual Studio Code (recomendado)
- Git

### Cuentas y APIs Requeridas

1. **Airtable**
   - Cuenta gratuita en [airtable.com](https://airtable.com)
   - Base de datos creada para pacientes
   - API Key generada

2. **Google Calendar**
   - Cuenta de Google
   - Proyecto en Google Cloud Console
   - API Key para Calendar API

3. **N8N** (Opcional)
   - Instancia de N8N local o en la nube
   - Webhook configurado

## üõ†Ô∏è Instalaci√≥n

### 1. Clonar el Repositorio

```bash
git clone https://github.com/tu-usuario/sistema-odontologico.git
cd sistema-odontologico
```

### 2. Crear Entorno Virtual

```bash
# Crear entorno virtual
python -m venv dental_env

# Activar entorno virtual
# En Windows:
dental_env\Scripts\activate
# En macOS/Linux:
source dental_env/bin/activate
```

### 3. Instalar Dependencias

```bash
pip install -r requirements.txt
```

### 4. Configurar Variables de Entorno

```bash
# Copiar archivo de ejemplo
cp .env.example .env

# Editar .env con tus configuraciones
```

Configura las siguientes variables en tu archivo `.env`:

```env
# Flask Configuration
SECRET_KEY=tu-clave-secreta-super-segura-aqui
FLASK_ENV=development
FLASK_DEBUG=True

# Airtable Configuration
AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX
AIRTABLE_API_KEY=keyXXXXXXXXXXXXXX

# Google Calendar API
GOOGLE_CALENDAR_API_KEY=AIzaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
GOOGLE_CALENDAR_ID=tu-email@gmail.com

# N8N Webhook Configuration
N8N_WEBHOOK_URL=https://tu-instancia-n8n.com/webhook/dental-system
```

## ‚öôÔ∏è Configuraci√≥n de Servicios

### Configurar Airtable

1. **Crear Base de Datos**:
   - Ve a [airtable.com](https://airtable.com) y crea una nueva base
   - N√≥mbrala "Sistema Odontol√≥gico" o similar

2. **Configurar Tabla de Pacientes**:
   Crea una tabla llamada "Pacientes" con los siguientes campos:

   | Campo | Tipo | Descripci√≥n |
   |-------|------|-------------|
   | Nombre | Single line text | Nombre completo del paciente |
   | DNI | Single line text | Documento de identidad |
   | Telefono | Phone number | N√∫mero de tel√©fono |
   | Email | Email | Correo electr√≥nico |
   | Obra Social | Single select | Obra social del paciente |
   | Numero Afiliado | Single line text | N√∫mero de afiliado |
   | Fecha Nacimiento | Date | Fecha de nacimiento |
   | Historia Clinica | Long text | Historia cl√≠nica completa |
   | Alergias | Long text | Alergias conocidas |
   | Antecedentes | Multiple select | Antecedentes m√©dicos |
   | Fecha Registro | Date and time | Fecha de registro autom√°tica |
   | Estado | Single select | Estado del paciente (Activo/Inactivo) |
   | Notas | Long text | Notas adicionales |

3. **Obtener API Key**:
   - Ve a tu [cuenta de Airtable](https://airtable.com/account)
   - Genera un Personal Access Token
   - Copia el Base ID desde la URL de tu base

### Configurar Google Calendar

1. **Crear Proyecto en Google Cloud Console**:
   ```
   1. Ve a console.cloud.google.com
   2. Crea un nuevo proyecto
   3. Habilita la Calendar API
   4. Crea credenciales (API Key)
   5. Configura las restricciones de la API Key
   ```

2. **Obtener Calendar ID**:
   - Ve a Google Calendar
   - En configuraci√≥n, busca tu calendar ID
   - Generalmente es tu email de Gmail

### Configurar N8N (Opcional)

1. **Instalar N8N**:
   ```bash
   npm install n8n -g
   # o usar Docker
   docker run -it --rm --name n8n -p 5678:5678 n8nio/n8n
   ```

2. **Crear Webhook**:
   - Ve a http://localhost:5678
   - Crea un nuevo workflow
   - Agrega un nodo Webhook
   - Configura la URL del webhook

## üöÄ Ejecuci√≥n

### Modo Desarrollo

```bash
# Activar entorno virtual
source dental_env/bin/activate  # o dental_env\Scripts\activate en Windows

# Ejecutar aplicaci√≥n
python app.py

# O usar Flask directamente
export FLASK_APP=app.py
export FLASK_ENV=development
flask run
```

La aplicaci√≥n estar√° disponible en: `http://localhost:5000`

### Modo Producci√≥n

```bash
# Instalar servidor WSGI (recomendado: gunicorn)
pip install gunicorn

# Configurar variables de producci√≥n
export FLASK_ENV=production
export SECRET_KEY="tu-clave-super-secreta-de-produccion"

# Ejecutar con gunicorn
gunicorn -w 4 -b 0.0.0.0:8000 app:app
```

## üìÅ Estructura del Proyecto

```
sistema-odontologico/
‚îú‚îÄ‚îÄ app.py                 # Aplicaci√≥n principal de Flask
‚îú‚îÄ‚îÄ config.py             # Configuraciones del sistema
‚îú‚îÄ‚îÄ requirements.txt      # Dependencias de Python
‚îú‚îÄ‚îÄ .env.example         # Variables de entorno de ejemplo
‚îú‚îÄ‚îÄ README.md            # Documentaci√≥n
‚îú‚îÄ‚îÄ templates/           # Templates HTML
‚îÇ   ‚îú‚îÄ‚îÄ base.html       # Template base
‚îÇ   ‚îú‚îÄ‚îÄ index.html      # P√°gina principal
‚îÇ   ‚îú‚îÄ‚îÄ pacientes.html  # Lista de pacientes
‚îÇ   ‚îú‚îÄ‚îÄ nuevo_paciente.html  # Formulario nuevo paciente
‚îÇ   ‚îú‚îÄ‚îÄ detalle_paciente.html  # Detalle de paciente
‚îÇ   ‚îî‚îÄ‚îÄ calendario.html # P√°gina de calendario
‚îú‚îÄ‚îÄ static/             # Archivos est√°ticos (CSS, JS, im√°genes)
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îî‚îÄ‚îÄ logs/              # Archivos de log (creado autom√°ticamente)
```

## üîß Uso del Sistema

### Gesti√≥n de Pacientes

1. **Agregar Nuevo Paciente**:
   - Ve a "Nuevo Paciente" en el men√∫
   - Completa todos los campos obligatorios
   - El paciente se guarda autom√°ticamente en Airtable

2. **Buscar Pacientes**:
   - Usa la barra de b√∫squeda en "Pacientes"
   - Filtra por obra social
   - Cambia entre vista de tabla y tarjetas

3. **Gestionar Historia Cl√≠nica**:
   - Cada paciente tiene su historia cl√≠nica completa
   - Se pueden agregar notas y antecedentes
   - Sistema de alertas para alergias

### Gesti√≥n de Calendario

1. **Ver Turnos**:
   - Sincronizaci√≥n autom√°tica con Google Calendar
   - Vista por d√≠a, semana o mes
   - Filtros por estado de turno

2. **Crear Turnos**:
   - Bot√≥n "Nuevo Turno" 
   - Selecci√≥n de paciente existente o nuevo
   - Configuraci√≥n de recordatorios autom√°ticos

3. **Gestionar Turnos**:
   - Editar, confirmar o cancelar turnos
   - Env√≠o de notificaciones autom√°ticas
   - Exportaci√≥n de agenda

## ü§ñ Automatizaciones con N8N

El sistema puede integrarse con N8N para automatizaciones avanzadas:

### Workflows Disponibles

1. **Nuevo Paciente**:
   - Env√≠o autom√°tico de email de bienvenida
   - Creaci√≥n de expediente digital
   - Notificaci√≥n al equipo m√©dico

2. **Recordatorios de Turnos**:
   - SMS/WhatsApp 24h antes de la cita
   - Email de confirmaci√≥n
   - Actualizaci√≥n autom√°tica de estados

3. **Seguimiento Post-Consulta**:
   - Encuesta de satisfacci√≥n autom√°tica
   - Programaci√≥n de controles
   - Facturaci√≥n automatizada

### Configurar Workflow Ejemplo

```json
{
  "name": "Nuevo Paciente Workflow",
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "nuevo-paciente",
        "responseMode": "onReceived"
      }
    },
    {
      "name": "Enviar Email",
      "type": "n8n-nodes-base.emailSend",
      "parameters": {
        "to": "={{$node.Webhook.json.email}}",
        "subject": "Bienvenido a nuestro consultorio",
        "text": "Gracias por registrarte, {{$node.Webhook.json.nombre}}"
      }
    }
  ]
}
```

## üîê Seguridad

### Medidas Implementadas

- **Validaci√≥n de Datos**: Validaci√≥n tanto en frontend como backend
- **Variables de Entorno**: Credenciales protegidas en archivo .env
- **HTTPS Ready**: Configuraci√≥n lista para SSL en producci√≥n
- **Headers de Seguridad**: Configuraci√≥n de headers seguros
- **Rate Limiting**: Protecci√≥n contra ataques de fuerza bruta (opcional)

### Recomendaciones de Producci√≥n

1. **Usar HTTPS**: Siempre utilizar certificados SSL
2. **Variables de Entorno**: No hardcodear credenciales
3. **Backup Regular**: Configurar backups autom√°ticos de Airtable
4. **Monitoring**: Implementar logs y monitoreo
5. **Actualizaciones**: Mantener dependencias actualizadas

## üêõ Soluci√≥n de Problemas

### Errores Comunes

**Error: "Airtable API Key invalid"**
```
Soluci√≥n: Verificar que el API Key y Base ID est√©n correctos en .env
```

**Error: "Google Calendar API quota exceeded"**
```
Soluci√≥n: Revisar l√≠mites de API en Google Cloud Console
```

**Error: "Port already in use"**
```
Soluci√≥n: 
# Encontrar proceso en puerto 5000
netstat -ano | findstr :5000  # Windows
lsof -i :5000  # macOS/Linux

# Cambiar puerto
flask run --port 5001
```

### Logs y Debugging

```bash
# Ver logs en tiempo real
tail -f logs/app.log

# Ejecutar en modo debug
export FLASK_DEBUG=1
flask run
```

## üö¢ Deployment

### Heroku

```bash
# Instalar Heroku CLI
# Crear Procfile
echo "web: gunicorn app:app" > Procfile

# Deploy
heroku create tu-sistema-odontologico
heroku config:set AIRTABLE_API_KEY=tu_key
heroku config:set AIRTABLE_BASE_ID=tu_base_id
git push heroku main
```

### DigitalOcean/AWS

```bash
# Usar gunicorn con systemd
sudo systemctl enable dental-system
sudo systemctl start dental-system

# Configurar nginx como reverse proxy
sudo nano /etc/nginx/sites-available/dental-system
```

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìù Changelog

### v1.0.0 (2025-08-18)
- ‚ú® Sistema base de gesti√≥n de pacientes
- üìÖ Integraci√≥n con Google Calendar
- üîÑ Webhooks para N8N
- üì± Interfaz responsive con Bootstrap 5
- üíæ Integraci√≥n completa con Airtable

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## üìû Soporte

Para soporte t√©cnico o consultas:
- Email: soporte@tu-consultorio.com
- Issues: [GitHub Issues](https://github.com/tu-usuario/sistema-odontologico/issues)
- Documentaci√≥n: [Wiki del proyecto](https://github.com/tu-usuario/sistema-odontologico/wiki)

---

‚≠ê **¬øTe gusta el proyecto? ¬°Dale una estrella en GitHub!**

Desarrollado con ‚ù§Ô∏è para la comunidad odontol√≥gica